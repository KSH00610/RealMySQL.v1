# 5.1 트랜잭션

MyISAM이나 MEMORY 스토리지 엔진은 트랜잭션을 지원하지 않으나, InnoDB의 경우 트랜잭션을 지원한다.

트랜잭션은 사용하기 복잡하고 번거롭다는 오해가 있지만, 사실은 **트랜잭션이 없다면 개발자들은 더 많은 고민거리를 떠 안아야 한다**.

## 5.1.1 MySQL에서의 트랜잭션

트랜잭션은 **꼭 여러 개의 변경 작업을 수행하는 쿼리가 조합됐을 때만 의미 있는 개념은 아니다**. 트랜잭션은 작업 셋에 쿼리가 몇 개이든 관계없이 논리적인 작업 셋 자체가 100% 적용되거나 아무것도 적용되지 않아야 함을 보장하는 역할을 한다.

아래와 같은 테이블이 MyISAM 엔진과 InnoDB 엔진에서 둘 다 존재한다고 가정하자.

각 테이블에서 다음과 같은 쿼리를 실행했을 때, 두 엔진의 처리 결과는 상이하다.

```SQL
INSERT INTO tab (fdpk) VALUES (1), (2), (3);
```

두 엔진에서의 쿼리 모두 **PK 중복 오류로 쿼리에 실패**한다. 그런데, MyISAM의 경우 오류가 발생했음에도 '1'과 '2'는 `INSERT`된 상태로 남아 있다. MyISAM의 경우 쿼리 도중 오류가 발생하더락도 **Rollback을 수행하지 않기 때문에 이와 같은 일이 발생**한다. 이런 현상을 **부분 업데이트(Partial update)** 라고 한다.

트랜잭션을 사용하지 않는다면, 직접 보정 쿼리를 작성해야한다. 이러한 작업은 단일 쿼리라면 간단할 수 있겠지만 쿼리가 2개 이상 있는 쿼리 셋이라면 매우 복잡해지고 고민거리로 남을 수 있다.

## 5.1.2 주의사항

트랜잭션 또한 DBMS 커넥션과 동일하게 꼭 필요한 최소의 코드에만 적용하는 것이 좋다. 즉, 프로그램 코드에서 **트랜잭션의 범위를 최소화하라는 의미**이다.

- 애플리케이션 로직을 트랜잭션으로 묶는 것을 지양하라
- 네트워크를 통해 원격 서버와 통신하는 작업을 트랜잭션에 포함하는 것을 지양하라
