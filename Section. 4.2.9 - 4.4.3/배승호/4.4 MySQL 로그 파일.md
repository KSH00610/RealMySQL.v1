# 4.4 MySQL 로그 파일

## 4.4.1 에러 로그 파일

에러 로그 파일은 MySQL 실행 도중 발생하는 에러나 경고 메시지가 출력되는 로그 파일이다.

`my.cnf`파일의 `log_error` 라는 이름의 파라미터로 정의된 경로에 생성되는데, 아래와 같은 메시지를 자주 접하게 될 것이다.

-   MySQL이 시작하는 과정과 관련된 정보성/에러 메시지
-   InnoDB 트랜잭션 복구 메시지: 마지막으로 종료 시 비정상적으로 종료된 경우
-   쿼리 처리 도중에 발생한 문제에 대한 에러 메시지
-   비정상적으로 종료된 커넥션 메시지
-   InnoDB 모니터링/상태 조회 명령 결과 메시지
-   MySQL 종료 메시지

## 4.4.2 제너럴 쿼리 로그 파일(제너럴 로그 파일, General log)

MySQL 서버에서 실행되는 쿼리로 어떤 것들이 있는지 검토해야 할 때가 있는데, 쿼리 로그를 활성화해서 쿼리를 쿼리 로그 파일로 기록할 수 있다.

쿼리 로그는 파일이 아닌 테이블에 저장하도록 설정할 수 있다. 이 경우에는 SQL로 조회해서 검토해야 한다.

## 4.4.3 슬로우 쿼리 로그

슬로우 쿼리 로그는 `long_query_time`에 설정된 시간 이상이 소요된 쿼리가 모두 기록된다. 이는 서비스 운영 중 성능 저하의 원인이 되는 쿼리를 판단하는데 큰 도움이 된다.

MySQL이 쿼리를 실행하고 실제 소요된 시간을 기준으로 기록되므로 반드시 쿼리가 정상적으로 실행이 완료돼야 슬로우 쿼리 로그에 기록될 수 있다.

슬로우 쿼리 또는 제너럴 로크 파일이 상당히 많아 직접 쿼리를 하나씩 검토하기 어려운 경우 Percona에서 개발한 Percona Toolkit의 `pt-query-digest` 스크립트를 통해 빈도나 처리 성능별로 쿼리를 정렬해 볼 수 있다. 로그 파일 분석이 완료되면 결과는 아래의 3개의 그룹으로 나누어저 저장된다.

### 4.4.3.1 슬로우 쿼리 통계

분석 결과 최상단에 표시됨. 모든 쿼리를 대상으로 슬로우 쿼리 로그의 실행시간, 잠금 대기 시간 등에 대해 평균 및 최소/최대 값을 표시한다.

### 4.4.3.2 실행 빈도 및 누적 실행 시간순 랭킹

각 쿼리별로 응답 시간과 실행 횟수를 보여준다. `Query ID`는 실행된 쿼리 문장을 정규화해서 만들어진 해시 값을 의미한다. 일반적으로 같은 모양의 쿼리는 동일한 `Query ID`를 가지게 된다.

### 4.4.3.3 쿼리별 실행 횟수 및 누적 실행 시간 상세정보

Query ID별 쿼리를 랭킹에 표시된 순서로 자세한 내용을 보여준다. 쿼리가 얼마나 실행됐는지, 쿼리의 응답 시간에 대한 히스토그램 같은 상세한 내용을 보여준다.
